<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¬ãƒ¼ãƒ‡ãƒ³å…«æ½® ç·åˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        /* === Base Styles === */
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: #f8fafc;
            color: #334155;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }
        
        /* === Animations === */
        .fade-in-up { animation: fadeInUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        .modal-enter { animation: modalEnter 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes modalEnter { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

        /* === Calendar Styles === */
        .calendar-day {
            aspect-ratio: 1; display: flex; align-items: center; justify-content: center;
            border-radius: 12px; cursor: pointer; position: relative; font-weight: 600;
            transition: all 0.2s ease; color: #64748b;
        }
        .calendar-day:hover:not(.empty-day) { background-color: #e2e8f0; color: #1e293b; }
        .calendar-day.has-event::after {
            content: ''; position: absolute; bottom: 15%; left: 50%; transform: translateX(-50%);
            width: 5px; height: 5px; border-radius: 50%; background-color: #ef4444;
        }
        .calendar-day.is-today { background-color: #fef08a; color: #854d0e; border: 2px solid #eab308; }
        .calendar-day.is-selected { background-color: #4f46e5; color: white; box-shadow: 0 4px 10px -2px rgba(79, 70, 229, 0.4); }

        /* === QSC Styles === */
        .qsc-checkbox { appearance: none; width: 1.25rem; height: 1.25rem; border: 2px solid #cbd5e1; border-radius: 0.375rem; cursor: pointer; transition: all 0.2s; position: relative; }
        .qsc-checkbox:checked { background-color: #22c55e; border-color: #22c55e; }
        .qsc-checkbox:checked::after { content: 'âœ“'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 0.875rem; font-weight: bold; }

        /* === Utility === */
        .text-pretty { text-wrap: pretty; }
        .word-keep { display: inline-block; }

        /* =========================================
           Task Manager Styles (Timeline & Edit)
           ========================================= */
        .timeline-container {
            width: 100%; overflow-x: auto; background-color: #ffffff; border: 1px solid #e2e8f0;
            border-radius: 1rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); position: relative; padding-bottom: 8px;
        }
        .timeline-table { width: 100%; min-width: 1200px; border-collapse: separate; border-spacing: 0; }
        .timeline-table th, .timeline-table td {
            border-bottom: 1px solid #f1f5f9; border-right: 1px solid #f1f5f9; padding: 0;
            height: 4rem; vertical-align: top; position: relative; box-sizing: border-box;
        }
        .timeline-table thead th {
            background-color: #f8fafc; color: #64748b; font-size: 0.75rem; font-weight: 700;
            text-align: center; vertical-align: middle; position: sticky; top: 0; z-index: 20;
            padding: 0.75rem 0; border-bottom: 2px solid #e2e8f0;
        }
        .timeline-table tbody th {
            background-color: #ffffff; color: #1e293b; font-size: 0.9rem; font-weight: 700;
            min-width: 160px; max-width: 160px; position: sticky; left: 0; z-index: 10;
            text-align: left; padding: 0 1rem; vertical-align: middle; border-right: 2px solid #e2e8f0;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis; box-shadow: 4px 0 10px -5px rgba(0,0,0,0.05);
        }
        .task-bar {
            position: absolute; top: 6px; left: 1px; right: 1px; bottom: 6px; border-radius: 6px;
            padding: 0 0.5rem; font-size: 0.75rem; font-weight: 700; display: flex; align-items: center; justify-content: space-between;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); overflow: hidden; white-space: nowrap; z-index: 5; transition: transform 0.1s; cursor: pointer;
        }
        .task-bar:hover { z-index: 30; transform: scaleY(1.1) scaleX(1.01); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        /* Task Colors */
        .task-bar.pair-task { background: #fee2e2; color: #991b1b; border-left: 4px solid #ef4444; }
        .task-bar.briefing-task { background: #d1fae5; color: #065f46; border-left: 4px solid #10b981; }
        .task-bar.money-task { background: #fef9c3; color: #854d0e; border-left: 4px solid #eab308; }
        .task-bar.free-task { background: #f8fafc; color: #94a3b8; border: 1px dashed #cbd5e1; box-shadow: none; }
        .task-bar.parking-task { background: #dbeafe; color: #1e40af; border-left: 4px solid #3b82f6; }
        .task-bar.lock-task, .task-bar.toolbox-task, .task-bar.handoff-task { background: #f3e8ff; color: #6b21a8; border-left: 4px solid #a855f7; }
        .task-bar.alba-close-task { background: #ffe4e6; color: #be123c; border-left: 4px solid #f43f5e; }
        .task-bar.staff-15min-task, .task-bar.special-opening-task { background: #cffafe; color: #155e75; border-left: 4px solid #06b6d4; }

        /* Edit Table */
        .task-table { width: 100%; border-collapse: collapse; }
        .task-table th { text-align: left; padding: 0.75rem 1rem; font-size: 0.75rem; font-weight: 700; color: #64748b; background-color: #f8fafc; border-bottom: 1px solid #e2e8f0; }
        .task-table td { padding: 0.75rem 1rem; border-bottom: 1px solid #f1f5f9; vertical-align: middle; }

        /* Shared Modals */
        .modal-overlay, .select-modal-overlay {
            position: fixed; inset: 0; background-color: rgba(15, 23, 42, 0.6); backdrop-filter: blur(4px);
            display: flex; align-items: center; justify-content: center; z-index: 50; padding: 1rem;
        }
        .modal-content, .select-modal-content {
            background: white; border-radius: 1rem; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            width: 100%; max-width: 500px; overflow: hidden; animation: modalIn 0.2s ease-out forwards;
        }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .select-modal-body { max-height: 60vh; overflow-y: auto; }
        .select-modal-option { padding: 0.75rem 1.25rem; cursor: pointer; border-bottom: 1px solid #f1f5f9; transition: background 0.2s; font-size: 0.95rem; font-weight: 500; }
        .select-modal-option:hover { background-color: #f8fafc; }
        .select-modal-option.selected { background-color: #eff6ff; color: #2563eb; font-weight: 700; }
        .custom-select-button {
            width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0.75rem;
            background: white; border: 1px solid #cbd5e1; border-radius: 0.5rem; font-size: 0.875rem; transition: all 0.2s; text-align: left; height: 2.5rem;
        }
        .custom-select-button:hover { border-color: #94a3b8; }
        .custom-select-button.placeholder { color: #94a3b8; }

        @media (max-width: 767px) {
            .task-table thead { display: none; }
            .task-table tr { display: block; margin-bottom: 1rem; border: 1px solid #e2e8f0; border-radius: 0.75rem; padding: 1rem; background: white; }
            .task-table td { display: block; padding: 0.25rem 0; border: none; }
            .task-table td::before { content: attr(data-label); font-weight: 700; font-size: 0.75rem; color: #94a3b8; display: block; margin-bottom: 0.1rem; }
        }
    </style>
</head>
<body class="antialiased pb-20">

    <!-- =========================================
         ã€ç”»é¢1ã€‘é¡§å®¢å‘ã‘ (GARDEN BOT)
         ========================================= -->
    <div id="app-customer" class="transition-opacity duration-300">
        <!-- Header -->
        <header class="sticky top-0 z-30 bg-white/90 backdrop-blur-md border-b border-slate-200/60">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
                <a href="#" class="flex items-center gap-2 group">
                    <span class="text-xl font-black tracking-tighter text-slate-800 group-hover:text-indigo-600 transition-colors">
                        GARDEN<span class="text-indigo-600 group-hover:text-slate-800 transition-colors">BOT</span>
                    </span>
                </a>
                <span id="currentDate" class="text-xs font-bold text-slate-500 bg-slate-100 px-3 py-1.5 rounded-full hidden sm:inline-block tracking-wide"></span>
            </div>
        </header>

        <main>
            <!-- Hero Slider -->
            <section class="relative pt-8 pb-12 sm:pt-12 sm:pb-20 bg-white rounded-b-[2.5rem] shadow-sm overflow-hidden">
                <div class="container mx-auto px-4 sm:px-6 text-center">
                    <div class="relative w-full max-w-4xl mx-auto rounded-2xl overflow-hidden shadow-2xl shadow-indigo-900/10 border border-slate-100">
                        <div class="aspect-[16/9] bg-slate-900 flex items-center justify-center">
                            <img src="sinsou1.jpg" class="w-full h-full object-contain" alt="æ–°è£…é–‹åº—">
                        </div>
                    </div>
                    
                    <div class="mt-8 fade-in-up" style="animation-delay: 0.1s;">
                        <h1 class="text-3xl sm:text-5xl font-black text-slate-800 tracking-tight leading-tight text-pretty">
                            æœ€æ–°å°ã®æƒ…å ±ã‚’ã€<br class="sm:hidden">ã‚‚ã£ã¨<span class="text-indigo-600 inline-block">ã‚¹ãƒãƒ¼ãƒˆ</span>ã«ã€‚
                        </h1>
                    </div>

                    <!-- â–¼â–¼â–¼ ã‚¹ã‚¿ãƒƒãƒ•ç”¨ã‚¿ã‚¹ã‚¯ãƒœã‚¿ãƒ³ (è¿½åŠ ) â–¼â–¼â–¼ -->
                    <div class="mt-6 fade-in-up" style="animation-delay: 0.2s;">
                        <button onclick="switchView('staff')" class="inline-flex items-center gap-2 bg-slate-800 hover:bg-slate-700 text-white text-sm font-bold px-6 py-3 rounded-full shadow-lg shadow-slate-200 transition-all transform hover:scale-105">
                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" /></svg>
                            <span>æœ¬æ—¥ã®ã‚¿ã‚¹ã‚¯ã‚’ç¢ºèªã™ã‚‹ (ã‚¹ã‚¿ãƒƒãƒ•ç”¨)</span>
                        </button>
                    </div>
                    <!-- â–²â–²â–² è¿½åŠ ã“ã“ã¾ã§ â–²â–²â–² -->
                </div>
            </section>

            <!-- Action Button (æ–°è£…é–‹åº—æƒ…å ±) -->
            <div class="container mx-auto px-4 -mt-8 relative z-10 fade-in-up" style="animation-delay: 0.3s;">
                <div id="newOpeningButton" class="group cursor-pointer bg-white rounded-2xl shadow-xl shadow-indigo-900/5 border border-slate-100 p-6 sm:p-8 max-w-xl mx-auto hover:translate-y-[-4px] hover:shadow-2xl transition-all duration-300">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-5">
                            <div class="bg-indigo-50 text-indigo-600 p-4 rounded-2xl shrink-0 group-hover:bg-indigo-600 group-hover:text-white transition-colors duration-300">
                                <svg class="w-7 h-7" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" /></svg>
                            </div>
                            <div>
                                <h2 class="text-xl sm:text-2xl font-bold text-slate-800 group-hover:text-indigo-700 transition-colors">æ–°è£…é–‹åº—æƒ…å ±</h2>
                                <p class="text-slate-500 text-sm sm:text-sm font-medium mt-0.5">12æœˆ8æ—¥å°å…¥æ©Ÿç¨®ã®ã‚¹ãƒšãƒƒã‚¯è©³ç´°</p>
                            </div>
                        </div>
                        <div class="bg-slate-100 rounded-full p-2 text-slate-400 group-hover:bg-indigo-100 group-hover:text-indigo-600 transition-colors">
                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7"/></svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pachinko & Slot Strategy (çœç•¥ã›ãšãã®ã¾ã¾) -->
            <section class="container mx-auto px-4 mt-16 fade-in-up" style="animation-delay: 0.35s;">
                <div class="bg-white rounded-3xl border border-slate-100 shadow-sm max-w-4xl mx-auto overflow-hidden">
                    <div class="bg-sky-50/80 px-6 py-4 border-b border-sky-100 flex items-center gap-3">
                        <span class="flex h-2.5 w-2.5 rounded-full bg-sky-500"></span>
                        <h2 class="font-bold text-sky-900 text-lg">ãƒ‘ãƒãƒ³ã‚³ãƒãƒ¼ãƒ ã®ã”æ¡ˆå†…</h2>
                    </div>
                    <div class="p-6 sm:p-10">
                        <div class="mb-8 text-center sm:text-left">
                            <h3 class="text-2xl font-black text-slate-800 leading-tight text-pretty">ä»Šé€±ã®<span class="text-sky-600 word-keep">ãƒ‘ãƒãƒ³ã‚³æˆ¦ç•¥</span></h3>
                            <p class="text-slate-500 mt-2 font-medium">é€±æœ«ã®æ™‚å·®å³¶15æ™‚ç¨¼åƒãƒ»æº€å°ã‚’ç›®æŒ‡ã—ã¦å¾¹åº•å¼·åŒ–ï¼</p>
                        </div>
                        <div class="mb-6 bg-gradient-to-br from-purple-50 to-white p-6 rounded-2xl border border-purple-100 relative overflow-hidden shadow-sm">
                            <div class="flex flex-col sm:flex-row gap-4 items-start sm:items-center relative z-10">
                                <div class="bg-purple-100 text-purple-600 p-3 rounded-xl shrink-0">
                                    <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                                </div>
                                <div>
                                    <div class="text-xs font-bold text-purple-600 mb-1 flex items-center gap-2"><span class="bg-purple-600 text-white px-2 py-0.5 rounded-full text-[10px]">æ³¨ç›®</span>11/26 (æ°´) ï½ 12/2 (ç«)</div>
                                    <div class="font-bold text-slate-800 text-lg sm:text-xl mb-1">3é€±é€£ç¶š ã‚¨ãƒ´ã‚¡ã‚·ãƒªãƒ¼ã‚ºæ¨å¥¨</div>
                                    <p class="text-sm text-slate-600">å¸‚å ´å†…ã§ã®å­˜åœ¨æ„Ÿã‚’ç¢ºç«‹ã™ã‚‹ãŸã‚ã€3é€±é€£ç¶šã§å¾¹åº•ãƒ—ãƒƒã‚·ãƒ¥ï¼</p>
                                </div>
                            </div>
                        </div>
                        <div class="grid gap-4 sm:grid-cols-2">
                            <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm relative group hover:border-orange-300 transition-colors">
                                <div class="text-xs font-bold text-orange-500 mb-1">æ™‚å·®å³¶ & å¹³æ—¥ãƒ»é€±æœ«å…±é€š</div>
                                <div class="font-bold text-slate-800 mb-2 text-lg">ç‚ç‚ãƒæ¶ˆé˜²éšŠ2</div>
                                <p class="text-sm text-slate-600 leading-relaxed">æ™‚å·®å³¶å–¶æ¥­ã®ä¸»è»¸æ©Ÿç¨®ã€‚å¹³æ—¥ã‚‚é€±æœ«ã‚‚å¼•ãç¶šããŠã™ã™ã‚ï¼</p>
                            </div>
                            <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm relative group hover:border-indigo-300 transition-colors">
                                <div class="text-xs font-bold text-slate-500 mb-1">æ™‚å·®ãŒãªã„æ—¥ã¯â€¦</div>
                                <div class="font-bold text-slate-800 mb-2 text-lg">ã‹ã‚‰ãã‚Šã‚µãƒ¼ã‚«ã‚¹2</div>
                                <p class="text-sm text-slate-600 leading-relaxed">è¿‘éš£çŠ¶æ³ã‚’è¦‹ã¦èª¿æ•´ã€‚æ™‚å·®å¯¾è±¡å¤–ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã¯ã€Œã‹ã‚‰ãã‚Š2ã€ãŒæ¨å¥¨ï¼</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="container mx-auto px-4 mt-16 fade-in-up" style="animation-delay: 0.4s;">
                <div class="bg-white rounded-3xl border border-slate-100 shadow-sm max-w-4xl mx-auto overflow-hidden">
                    <div class="bg-slate-50/80 px-6 py-4 border-b border-slate-100 flex items-center gap-3">
                        <span class="flex h-2.5 w-2.5 rounded-full bg-indigo-500"></span>
                        <h2 class="font-bold text-slate-700 text-lg">ã‚¹ãƒ­ãƒƒãƒˆãƒãƒ¼ãƒ ã®ã”æ¡ˆå†…</h2>
                    </div>
                    <div class="p-6 sm:p-10">
                        <div class="mb-8 text-center sm:text-left">
                            <h3 class="text-2xl font-black text-slate-800 leading-tight text-pretty"><span class="word-keep">å¹´ä¸€ã®ç¥­å…¸</span><span class="text-rose-600 word-keep">ã€Œ28æ—¥ã€</span>ã«å‘ã‘ãŸ<br class="sm:hidden">é›†å¤§æˆã‚¦ã‚£ãƒ¼ã‚¯</h3>
                            <p class="text-slate-500 mt-2 font-medium">11æœˆãƒ©ã‚¹ãƒˆã€å®šä¼‘æ—¥ãªã—ã§é§†ã‘æŠœã‘ã¾ã™ï¼</p>
                        </div>
                        <div class="grid gap-4 sm:grid-cols-2">
                            <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                                <div class="text-xs font-bold text-indigo-500 mb-1">11/24 (æœˆ)</div>
                                <div class="font-bold text-slate-800 mb-2">æ¥µä¸Šãƒãƒƒãƒ†ã‚£ãƒ¼ Ã— ã¿ãƒ¼ã¾ã‚‹</div>
                                <p class="text-sm text-slate-600 leading-relaxed text-pretty">ã‚¹ãƒ­ãƒƒãƒˆå…¨èˆ¬ï¼†ç‰©è²©é–‹å‚¬ã€‚æœã‹ã‚‰ã®ç››ã‚Šä¸ŠãŒã‚Šå¿…è‡³ï¼Wæ¥åº—ã§å¾¹åº•ã‚¢ãƒ”ãƒ¼ãƒ«ã€‚</p>
                            </div>
                            <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                                <div class="text-xs font-bold text-slate-500 mb-1">11/25 (ç«) ï½ 27 (æœ¨)</div>
                                <div class="font-bold text-slate-800 mb-2">å¤•æ–¹æ™‚å·®ç‹™ã„ & æœˆå‘¨å¹´</div>
                                <p class="text-sm text-slate-600 leading-relaxed text-pretty">27æ—¥ã¯æœˆå‘¨å¹´æ—¥2ndï¼ãƒãƒ³ã‚³ãƒ„çé“ä¸­åéŒ²ã€‚å¤•æ–¹ã‹ã‚‰ã®æ™‚å·®é–‹æ”¾ã‚‚è¦‹é€ƒã›ãªã„ã€‚</p>
                            </div>
                            <div class="sm:col-span-2 bg-rose-50/50 p-6 rounded-xl border border-rose-100 relative overflow-hidden">
                                <div class="relative z-10">
                                    <div class="text-xs font-bold text-rose-600 mb-1 flex items-center gap-2"><span class="bg-rose-600 text-white px-2 py-0.5 rounded-full text-[10px]">æœ€é‡è¦</span>11/28 (é‡‘)</div>
                                    <div class="font-bold text-rose-900 text-lg mb-2">å¹´ä¸€ã€Œ1128ã€Ã— 8ã®æ—¥</div>
                                    <p class="text-sm text-rose-800 leading-relaxed text-pretty"><span class="font-bold">ã€å…«æ½®ä¸Šç©º / çœŸéª¨è¶… / ããšãƒ‘ãƒåéŒ²ã€‘</span><br>å¹´ã«ä¸€åº¦ã®ãŠç¥­ã‚Šæ—¥ã€‚ã‚¹ãƒ­ãƒƒãƒˆã€ŒçœŸéª¨è¶…ã€ã€ãƒ‘ãƒãƒ³ã‚³ã€Œããšãƒ‘ãƒã€ã®Wã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã€‚</p>
                                </div>
                            </div>
                            <div class="sm:col-span-2 bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                                <div class="text-xs font-bold text-green-600 mb-1">11/29 (åœŸ) ï½ 30 (æ—¥)</div>
                                <div class="font-bold text-slate-800 mb-2">é€±æœ«è±ªè¯ãƒªãƒ¬ãƒ¼</div>
                                <p class="text-sm text-slate-600 leading-relaxed text-pretty">29æ—¥ï¼šå¤©è‰ã•ã‚“+ãã‚ã‚€ã•ã‚“ï¼ˆå¡Šç‹™ã„ï¼‰ / 30æ—¥ï¼šã‚¹ãƒ­ãƒ‘ãƒforåŸ¼ç‰ï¼ˆATæ©Ÿï¼†ã‚¸ãƒ£ã‚°ãƒ©ãƒ¼ï¼‰</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Calendar & Floor Map -->
            <section class="container mx-auto px-4 mt-12 max-w-4xl">
                <div class="bg-white rounded-3xl border border-slate-100 shadow-lg mb-12 overflow-hidden">
                    <div class="p-6 sm:p-8 flex flex-col sm:flex-row sm:items-end justify-between gap-4 border-b border-slate-50">
                        <div>
                            <h2 class="text-3xl font-black text-slate-800">Event Calendar</h2>
                            <p class="text-slate-400 text-sm font-bold mt-1">æœ¬æ—¥ã®ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±</p>
                        </div>
                        <button id="calendarToggleButton" class="text-sm font-bold text-indigo-600 bg-indigo-50 hover:bg-indigo-100 px-4 py-2 rounded-lg transition-colors">ä»Šæœˆå…¨ä½“ã‚’è¦‹ã‚‹</button>
                    </div>
                    <div class="p-6 sm:p-8">
                        <div id="todayEventContainer" class="bg-white min-h-[120px] flex items-center justify-center">
                            <div class="animate-pulse flex flex-col items-center gap-3 w-full">
                                <div class="h-4 bg-slate-100 rounded w-1/3"></div>
                                <div class="h-20 bg-slate-50 rounded-xl w-full"></div>
                            </div>
                        </div>
                        <div id="fullCalendarContainer" class="hidden mt-6 pt-6 border-t border-slate-100">
                            <div id="calendarGrid" class="grid grid-cols-7 gap-2 sm:gap-3 mb-6"></div>
                            <div id="selectedEventDetails" class="bg-slate-50 rounded-xl p-5 border border-slate-100 min-h-[100px] flex items-center justify-center text-slate-400 text-sm font-medium">æ—¥ä»˜ã‚’ã‚¿ãƒƒãƒ—ã—ã¦è©³ç´°ã‚’ç¢ºèª</div>
                        </div>
                    </div>
                </div>

                <!-- QSC -->
                <div class="bg-white rounded-3xl border border-slate-100 shadow-lg overflow-hidden">
                    <div class="bg-rose-50 border-b border-rose-100 px-6 py-4 flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                        <div class="flex items-center gap-2">
                             <span class="bg-rose-500 text-white p-1.5 rounded-lg">
                                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" /></svg>
                            </span>
                            <div>
                                <h3 class="font-bold text-rose-900 text-base">QSCãƒã‚§ãƒƒã‚¯ (ã‚¹ã‚¿ãƒƒãƒ•å…±æœ‰)</h3>
                                <p class="text-xs text-rose-700 font-medium" id="qscUnfinishedCount">æœªå®Ÿæ–½é …ç›®: èª­ã¿è¾¼ã¿ä¸­...</p>
                            </div>
                        </div>
                        <button id="openQSCButton" class="bg-rose-600 hover:bg-rose-700 text-white text-sm font-bold px-4 py-2.5 rounded-xl shadow-lg shadow-rose-200 transition-all flex items-center justify-center gap-2">ãƒªã‚¹ãƒˆã‚’é–‹ã</button>
                    </div>
                    <div class="p-6 sm:p-8 border-b border-slate-50">
                        <h2 class="text-2xl font-bold text-slate-800">Floor Map</h2>
                        <p class="text-slate-400 text-xs font-bold mt-1">ãƒ•ãƒ­ã‚¢ãƒãƒƒãƒ—</p>
                    </div>
                    <div class="p-4 sm:p-8">
                        <div class="bg-slate-50 rounded-xl border border-slate-200 p-2">
                            <img src="simazu.jpg" alt="Map" class="w-full rounded-lg shadow-sm" onerror="this.parentNode.innerHTML='<div class=\'py-20 text-center text-slate-400 font-bold\'>ãƒãƒƒãƒ—ç”»åƒã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸ</div>'">
                        </div>
                    </div>
                </div>
            </section>
        </main>
        <footer class="mt-20 py-10 text-center border-t border-slate-200 bg-slate-50">
            <p class="text-xs font-bold text-slate-400 tracking-widest">&copy; 2025 GARDEN YASHIO BOT</p>
        </footer>
    </div>


    <!-- =========================================
         ã€ç”»é¢2ã€‘ã‚¹ã‚¿ãƒƒãƒ•å‘ã‘ (TASK MANAGER)
         ========================================= -->
    <div id="app-staff" class="hidden min-h-screen bg-slate-50 text-slate-800 pb-20">
        <!-- Staff Header -->
        <header class="sticky top-0 z-40 bg-white/90 backdrop-blur-md border-b border-slate-200/60">
            <div class="container mx-auto px-4 sm:px-6 h-16 flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <button onclick="switchView('customer')" class="mr-2 p-2 rounded-full hover:bg-slate-100 transition-colors" title="é¡§å®¢ç”»é¢ã«æˆ»ã‚‹">
                        <svg class="w-6 h-6 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
                    </button>
                    <span class="text-xl font-black tracking-tighter text-slate-800">
                        TASK<span class="text-indigo-600">MANAGER</span>
                    </span>
                </div>
                <button id="edit-mode-button" onclick="showPasswordModal()" class="text-xs font-bold text-slate-600 bg-slate-100 hover:bg-slate-200 px-4 py-2 rounded-full transition-colors">
                    ç®¡ç†è€…ç·¨é›†
                </button>
            </div>
        </header>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 py-8">
            <!-- Title & Date -->
            <div class="text-center mb-10">
                <h1 class="text-3xl sm:text-4xl font-black text-slate-800 tracking-tight mb-6 text-balance">
                    é–‹é–‰åº—ã‚¿ã‚¹ã‚¯<span class="text-indigo-600">å‰²ã‚ŠæŒ¯ã‚Š</span>
                </h1>
                <div class="inline-flex items-center bg-white px-5 py-3 rounded-2xl shadow-sm border border-slate-200">
                    <span class="text-slate-400 mr-3 font-bold text-xs tracking-widest">DATE</span>
                    <input type="date" id="date-picker" onchange="handleDateChange(this.value)" class="font-bold text-lg text-slate-700 bg-transparent focus:outline-none cursor-pointer">
                </div>
            </div>

            <!-- Tabs -->
            <div class="flex justify-center mb-10">
                <div class="bg-slate-200 p-1 rounded-xl inline-flex shadow-inner">
                    <button id="tab-open" class="px-6 py-2.5 rounded-lg text-sm font-bold transition-all bg-white text-indigo-600 shadow-sm" onclick="showSubTab('open')">â˜€ é–‹åº—ä½œæ¥­ (æ—©ç•ª)</button>
                    <button id="tab-close" class="px-6 py-2.5 rounded-lg text-sm font-bold transition-all text-slate-500 hover:text-slate-700" onclick="showSubTab('close')">ğŸŒ™ é–‰åº—ä½œæ¥­ (é…ç•ª)</button>
                </div>
            </div>

            <!-- VIEW MODE (Timeline) -->
            <div id="view-mode-container" class="space-y-12">
                <div id="view-content-open" class="animate-fade-in space-y-12">
                    <section>
                        <div class="flex items-center gap-3 mb-4 px-2"><div class="w-1.5 h-6 bg-indigo-500 rounded-full"></div><h2 class="text-xl font-bold text-slate-800">æ—©ç•ª ç¤¾å“¡ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</h2></div>
                        <div id="summary-open-employee-container-desktop" class="hidden md:block"></div>
                        <div id="summary-open-employee-container-mobile" class="md:hidden"></div>
                    </section>
                    <section>
                        <div class="flex items-center gap-3 mb-4 px-2"><div class="w-1.5 h-6 bg-emerald-500 rounded-full"></div><h2 class="text-xl font-bold text-slate-800">æ—©ç•ª ã‚¢ãƒ«ãƒã‚¤ãƒˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</h2></div>
                        <div id="summary-open-alba-container-desktop" class="hidden md:block"></div>
                        <div id="summary-open-alba-container-mobile" class="md:hidden"></div>
                    </section>
                </div>
                <div id="view-content-close" class="hidden animate-fade-in space-y-12">
                    <section>
                        <div class="flex items-center gap-3 mb-4 px-2"><div class="w-1.5 h-6 bg-indigo-500 rounded-full"></div><h2 class="text-xl font-bold text-slate-800">é…ç•ª ç¤¾å“¡ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</h2></div>
                        <div id="summary-close-employee-container-desktop" class="hidden md:block"></div>
                        <div id="summary-close-employee-container-mobile" class="md:hidden"></div>
                    </section>
                    <section>
                        <div class="flex items-center gap-3 mb-4 px-2"><div class="w-1.5 h-6 bg-emerald-500 rounded-full"></div><h2 class="text-xl font-bold text-slate-800">é…ç•ª ã‚¢ãƒ«ãƒã‚¤ãƒˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</h2></div>
                        <div id="summary-close-alba-container-desktop" class="hidden md:block"></div>
                        <div id="summary-close-alba-container-mobile" class="md:hidden"></div>
                    </section>
                </div>
            </div>

            <!-- EDIT MODE -->
            <div id="edit-mode-container" class="hidden space-y-10">
                <!-- OPEN EDIT -->
                <div id="edit-content-open" class="space-y-10">
                    <section class="bg-white rounded-2xl p-6 md:p-8 border border-slate-200 shadow-sm">
                        <h2 class="text-lg font-bold text-slate-800 mb-1">æŒ‡å®šã‚¿ã‚¹ã‚¯æ‹…å½“è€… (é–‹åº—)</h2>
                        <p class="text-slate-500 text-sm mb-6">å›ºå®šã§è¡Œã†æ¥­å‹™ã®æ‹…å½“è€…ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚</p>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 mb-2 uppercase">é‡‘éŠ­æ¥­å‹™ (7:00-8:15)</label>
                                <button id="fixed-money_count-btn" class="custom-select-button bg-slate-50" onclick="openFixedStaffSelect('fixed_money_count', 'early_staff_candidates', 'é‡‘éŠ­æ¥­å‹™ æ‹…å½“è€…')"><span class="text-slate-400">é¸æŠã—ã¦ãã ã•ã„</span></button>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 mb-2 uppercase">å€‰åº« (9:15-9:45)</label>
                                <button id="fixed_open_warehouse-btn" class="custom-select-button bg-slate-50" onclick="openFixedStaffSelect('fixed_open_warehouse', 'open_staff_candidates', 'å€‰åº«(é–‹åº—) æ‹…å½“è€…')"><span class="text-slate-400">é¸æŠã—ã¦ãã ã•ã„</span></button>
                            </div>
                        </div>
                    </section>
                    <section class="bg-white rounded-2xl p-6 md:p-8 border border-slate-200 shadow-sm">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-lg font-bold text-slate-800">æ—©ç•ª ç¤¾å“¡ãƒªã‚¹ãƒˆ</h2>
                            <button onclick="autoAssignTasks('early', 'open')" class="text-xs font-bold bg-indigo-50 text-indigo-600 px-4 py-2 rounded-full hover:bg-indigo-100 transition">âš¡ è‡ªå‹•å‰²æŒ¯ã‚Š</button>
                        </div>
                        <div class="mb-6 flex gap-3">
                            <button id="add-staff-button-early" class="custom-select-button flex-grow" onclick="openStaffSelect('early', 'employees')"><span class="text-slate-400">ã‚¹ã‚¿ãƒƒãƒ•ã‚’è¿½åŠ ...</span></button>
                            <button onclick="addStaff('early')" class="bg-indigo-600 text-white font-bold px-6 rounded-lg hover:bg-indigo-700 transition">è¿½åŠ </button>
                        </div>
                        <div class="overflow-x-auto"><table class="task-table"><thead><tr><th>æ°å</th><th>é–‹å§‹</th><th>çµ‚äº†</th><th>ã‚¿ã‚¹ã‚¯</th><th>å‚™è€ƒ</th><th></th></tr></thead><tbody id="staff-list-open-early"></tbody></table></div>
                    </section>
                    <section class="bg-white rounded-2xl p-6 md:p-8 border border-slate-200 shadow-sm">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-lg font-bold text-slate-800">æ—©ç•ª ã‚¢ãƒ«ãƒã‚¤ãƒˆãƒªã‚¹ãƒˆ</h2>
                            <button onclick="autoAssignTasks('late', 'open')" class="text-xs font-bold bg-emerald-50 text-emerald-600 px-4 py-2 rounded-full hover:bg-emerald-100 transition">âš¡ è‡ªå‹•å‰²æŒ¯ã‚Š</button>
                        </div>
                        <div class="mb-6 flex gap-3">
                            <button id="add-staff-button-late" class="custom-select-button flex-grow" onclick="openStaffSelect('late', 'alba_early')"><span class="text-slate-400">ã‚¹ã‚¿ãƒƒãƒ•ã‚’è¿½åŠ ...</span></button>
                            <button onclick="addStaff('late')" class="bg-emerald-600 text-white font-bold px-6 rounded-lg hover:bg-emerald-700 transition">è¿½åŠ </button>
                        </div>
                        <div class="overflow-x-auto"><table class="task-table"><thead><tr><th>æ°å</th><th>é–‹å§‹</th><th>çµ‚äº†</th><th>ã‚¿ã‚¹ã‚¯</th><th>å‚™è€ƒ</th><th></th></tr></thead><tbody id="staff-list-open-late"></tbody></table></div>
                    </section>
                </div>
                <!-- CLOSE EDIT -->
                <div id="edit-content-close" class="space-y-10 hidden">
                    <section class="bg-white rounded-2xl p-6 md:p-8 border border-slate-200 shadow-sm">
                        <h2 class="text-lg font-bold text-slate-800 mb-1">æŒ‡å®šã‚¿ã‚¹ã‚¯æ‹…å½“è€… (é–‰åº—)</h2>
                        <div class="grid md:grid-cols-3 gap-6">
                            <div><label class="block text-xs font-bold text-slate-500 mb-2 uppercase">é‡‘éŠ­å›å</label><button id="fixed-money_collect-btn" class="custom-select-button bg-slate-50" onclick="openFixedStaffSelect('fixed_money_collect', 'closing_staff_candidates', 'æ‹…å½“è€…')"><span class="text-slate-400">é¸æŠ</span></button></div>
                            <div><label class="block text-xs font-bold text-slate-500 mb-2 uppercase">å€‰åº«æ•´ç†</label><button id="fixed-warehouses-btn" class="custom-select-button bg-slate-50" onclick="openFixedStaffSelect('fixed_warehouses', 'closing_staff_candidates', 'æ‹…å½“è€…')"><span class="text-slate-400">é¸æŠ</span></button></div>
                            <div><label class="block text-xs font-bold text-slate-500 mb-2 uppercase">ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼</label><button id="fixed-counters-btn" class="custom-select-button bg-slate-50" onclick="openFixedStaffSelect('fixed_counters', 'closing_staff_candidates', 'æ‹…å½“è€…')"><span class="text-slate-400">é¸æŠ</span></button></div>
                        </div>
                    </section>
                    <section class="bg-white rounded-2xl p-6 md:p-8 border border-slate-200 shadow-sm">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-lg font-bold text-slate-800">é…ç•ª ç¤¾å“¡ãƒªã‚¹ãƒˆ</h2>
                            <button onclick="autoAssignTasks('closing_employee', 'close')" class="text-xs font-bold bg-indigo-50 text-indigo-600 px-4 py-2 rounded-full hover:bg-indigo-100 transition">âš¡ è‡ªå‹•å‰²æŒ¯ã‚Š</button>
                        </div>
                        <div class="mb-6 flex gap-3">
                            <button id="add-staff-button-closing_employee" class="custom-select-button flex-grow" onclick="openStaffSelect('closing_employee', 'employees')"><span class="text-slate-400">ã‚¹ã‚¿ãƒƒãƒ•ã‚’è¿½åŠ ...</span></button>
                            <button onclick="addStaff('closing_employee')" class="bg-indigo-600 text-white font-bold px-6 rounded-lg hover:bg-indigo-700 transition">è¿½åŠ </button>
                        </div>
                        <div class="overflow-x-auto"><table class="task-table"><thead><tr><th>æ°å</th><th>é–‹å§‹</th><th>çµ‚äº†</th><th>ã‚¿ã‚¹ã‚¯</th><th>å‚™è€ƒ</th><th></th></tr></thead><tbody id="staff-list-close-employee"></tbody></table></div>
                    </section>
                    <section class="bg-white rounded-2xl p-6 md:p-8 border border-slate-200 shadow-sm">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-lg font-bold text-slate-800">é…ç•ª ã‚¢ãƒ«ãƒã‚¤ãƒˆãƒªã‚¹ãƒˆ</h2>
                            <button onclick="autoAssignTasks('closing_alba', 'close')" class="text-xs font-bold bg-emerald-50 text-emerald-600 px-4 py-2 rounded-full hover:bg-emerald-100 transition">âš¡ è‡ªå‹•å‰²æŒ¯ã‚Š</button>
                        </div>
                        <div class="mb-6 flex gap-3">
                            <button id="add-staff-button-closing_alba" class="custom-select-button flex-grow" onclick="openStaffSelect('closing_alba', 'alba_late')"><span class="text-slate-400">ã‚¹ã‚¿ãƒƒãƒ•ã‚’è¿½åŠ ...</span></button>
                            <button onclick="addStaff('closing_alba')" class="bg-emerald-600 text-white font-bold px-6 rounded-lg hover:bg-emerald-700 transition">è¿½åŠ </button>
                        </div>
                        <div class="overflow-x-auto"><table class="task-table"><thead><tr><th>æ°å</th><th>é–‹å§‹</th><th>çµ‚äº†</th><th>ã‚¿ã‚¹ã‚¯</th><th>å‚™è€ƒ</th><th></th></tr></thead><tbody id="staff-list-close-alba"></tbody></table></div>
                    </section>
                </div>
            </div>
        </main>
    </div>

    <!-- ================= MODALS (Global) ================= -->
    
    <!-- QSC Modal (Customer) -->
    <div id="qscModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4 transition-opacity">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[85vh] flex flex-col overflow-hidden modal-enter">
            <div class="p-4 sm:p-5 border-b border-slate-100 flex justify-between items-center bg-white shrink-0">
                <div class="flex items-center gap-2">
                    <h3 class="font-bold text-xl text-slate-800">QSC ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</h3>
                    <div class="flex bg-slate-100 p-1 rounded-lg">
                        <button id="qscTabUnfinished" class="px-3 py-1 text-xs font-bold rounded-md bg-white text-rose-600 shadow-sm transition-all">æœªå®Ÿæ–½</button>
                        <button id="qscTabFinished" class="px-3 py-1 text-xs font-bold rounded-md text-slate-400 hover:text-slate-600 transition-all">å®Œäº†æ¸ˆ</button>
                    </div>
                </div>
                <button id="closeQscModal" class="p-2 bg-slate-100 rounded-full text-slate-500 hover:bg-slate-200 transition"><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
            </div>
            <div class="flex-1 overflow-y-auto bg-slate-50 p-4 sm:p-6"><div id="qscListContainer" class="space-y-3"></div></div>
            <div class="p-3 bg-white border-t border-slate-100 text-center"><p class="text-xs text-slate-400 font-bold">ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã¨å…¨å“¡ã«å³æ™‚åæ˜ ã•ã‚Œã¾ã™</p></div>
        </div>
    </div>

    <!-- Machine Modals (Customer) -->
    <div id="newOpeningModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4 transition-opacity">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[85vh] flex flex-col overflow-hidden modal-enter">
            <div class="p-5 border-b border-slate-100 flex justify-between items-center bg-white shrink-0">
                <h3 class="font-bold text-xl text-slate-800">å°å…¥æ©Ÿç¨®ãƒªã‚¹ãƒˆ</h3>
                <button id="closeNewOpeningModal" class="p-2 bg-slate-100 rounded-full text-slate-500 hover:bg-slate-200 transition"><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
            </div>
            <div id="newOpeningInfo" class="p-5 overflow-y-auto bg-slate-50/50"></div>
        </div>
    </div>
    <div id="machineDetailModal" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm hidden z-[60] flex items-center justify-center p-4 transition-opacity">
        <div class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden modal-enter">
            <div class="bg-slate-800 p-6 sm:p-8 flex justify-between items-start shrink-0">
                <h3 id="detailName" class="text-xl sm:text-2xl font-bold text-white leading-tight pr-4"></h3>
                <button id="closeDetailModal" class="text-slate-400 hover:text-white transition"><svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
            </div>
            <div class="p-6 sm:p-8 overflow-y-auto">
                <div class="mb-8"><h4 class="text-xs font-black text-indigo-600 uppercase tracking-widest mb-3">SALES POINT</h4><p id="detailPitch" class="text-slate-700 text-base sm:text-lg font-medium leading-loose tracking-wide text-justify text-pretty"></p></div>
                <div class="grid sm:grid-cols-2 gap-6">
                    <div class="bg-emerald-50 p-5 rounded-2xl border border-emerald-100"><div class="flex items-center gap-2 mb-3 text-emerald-700 font-bold">GOOD POINT</div><ul id="detailPros" class="space-y-2 text-sm font-bold text-emerald-800"></ul></div>
                    <div class="bg-rose-50 p-5 rounded-2xl border border-rose-100"><div class="flex items-center gap-2 mb-3 text-rose-700 font-bold">BAD POINT</div><ul id="detailCons" class="space-y-2 text-sm font-bold text-rose-800"></ul></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Manager Modals (Staff) -->
    <div id="password-modal" class="modal-overlay hidden">
        <div class="modal-content p-8 text-center">
            <h3 class="text-xl font-bold text-slate-800 mb-2">ç®¡ç†è€…èªè¨¼</h3>
            <p class="text-sm text-slate-500 mb-6">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
            <input id="password-input" type="password" class="w-full p-3 border border-slate-200 rounded-lg mb-4 bg-slate-50 text-center font-bold focus:border-indigo-500 focus:outline-none" placeholder="Password">
            <p id="password-error" class="text-rose-500 text-xs font-bold mb-4 hidden">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™</p>
            <div class="flex gap-3 justify-center">
                <button onclick="closePasswordModal()" class="px-6 py-3 rounded-xl font-bold text-slate-500 hover:bg-slate-100 transition">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button onclick="checkPassword()" class="px-6 py-3 rounded-xl font-bold bg-indigo-600 text-white hover:bg-indigo-700 transition shadow-lg shadow-indigo-200">èªè¨¼</button>
            </div>
        </div>
    </div>
    <div id="select-modal" class="select-modal-overlay hidden">
        <div class="select-modal-content">
            <div class="p-4 border-b border-slate-100 font-bold text-slate-700" id="select-modal-title">é¸æŠ</div>
            <div id="select-modal-body" class="select-modal-body"></div>
            <div class="p-4 border-t border-slate-100 text-right"><button onclick="closeSelectModal()" class="text-sm font-bold text-slate-500 hover:text-slate-700">é–‰ã˜ã‚‹</button></div>
        </div>
    </div>
    <div id="remarks-modal" class="modal-overlay hidden">
        <div class="modal-content p-6">
            <h3 class="text-lg font-bold text-slate-800 mb-1" id="remarks-modal-task"></h3>
            <p class="text-xs font-bold text-slate-400 mb-4" id="remarks-modal-time"></p>
            <div class="bg-slate-50 p-4 rounded-xl border border-slate-100 text-slate-700 text-sm font-medium leading-relaxed mb-6" id="remarks-modal-text"></div>
            <button onclick="closeRemarksModal()" class="w-full py-3 rounded-xl font-bold bg-slate-100 text-slate-600 hover:bg-slate-200 transition">é–‰ã˜ã‚‹</button>
        </div>
    </div>
    <div id="delete-modal" class="modal-overlay hidden">
        <div class="modal-content p-8 text-center">
            <div class="w-14 h-14 bg-rose-100 text-rose-600 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-7 h-7" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
            </div>
            <h3 class="text-xl font-bold text-slate-800 mb-2">å‰Šé™¤ç¢ºèª</h3>
            <p id="delete-modal-message" class="text-sm text-slate-500 mb-6"></p>
            <div class="flex gap-3 justify-center">
                <button onclick="cancelDelete()" class="px-6 py-2.5 rounded-xl font-bold text-slate-500 hover:bg-slate-100 transition">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button onclick="confirmDelete()" class="px-6 py-2.5 rounded-xl font-bold bg-rose-600 text-white hover:bg-rose-700 transition shadow-lg shadow-rose-200">å‰Šé™¤ã™ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- =========================================
         LOGIC: Task Manager (Pure JS)
         ========================================= -->
    <script>
        // Staff & Task Data
        const masterStaffList = {
            employees: ["é–¢å£ å‘¨å¾", "éˆ´æœ¨å„ªå¸Œ", "éˆ´æœ¨ é”ä¹Ÿ", "æˆç”° å¥å¾", "æŸ³è°· åœ­äº®", "çŸ³å±±å³»å†´", "å°é‡å‚éš¼", "è‹¥æ¾è„©æ–—", "ç”Ÿæ²¼å½ª"],
            alba_early: ["æ ¹å²¸ éº»ç¾", "äº”ååµ ç”±è¡£", "æ›²å±± ç´èœ", "å±±åŒ— æ¡ƒé¦™", "ä¸Šåœ°ä½‘å¤", "ä¸­æ‘ ä»ç¾", "ç ‚å· æ„›é¦™", "æ‘ä¸Šéº»è¡£", "å°æ—å¤ç¾", "é«˜æ©‹ç‘ç©‚", "ç´°ç”° ç«œæˆ"],
            alba_late: ["å¯Œå²¡ åƒå°‹", "æµ…ç¾½é§¿æ±°", "å €åˆ‡ç¶¾", "å¤§å±± çœŸèœ", "é‡‘ç”° æ„›ä¼½", "æ¢…æ´¥ä¸–é‚£", "é«˜æ©‹ è‰¯ç¶­æ²³", "ç«‹å²©æ˜­äºº"]
        };
        const openStaffCandidates = [...masterStaffList.employees, ...masterStaffList.alba_early].sort();
        const closingStaffCandidates = [...masterStaffList.employees, ...masterStaffList.alba_late].sort();
        const SPECIAL_TASKS = {
            BRIEFING: { name: "æœç¤¼", slots: 1, class: 'briefing-task' },
            FREE_TASK: { name: "å€‹äººæ¥­å‹™ã€è‡ªç”±æ™‚é–“", slots: 0, class: 'free-task' },
            MONEY_COUNT: { name: "é‡‘éŠ­æ¥­å‹™", slots: 5, class: 'money-task' },
            OUTSIDE_SALES: { name: "å¤–è²©å‡ºã—ã€æ–°èã€å²¡æŒ", slots: 1, class: 'staff-15min-task' },
            P_CHECK: { name: "På°ãƒã‚§ãƒƒã‚¯", slots: 1, class: 'staff-15min-task' },
            PROMOTION_CHECK: { name: "è²©ä¿ƒç¢ºèª", slots: 1, class: 'staff-15min-task' },
            OPEN_WAREHOUSE: { name: "å€‰åº«(é–‹åº—)", slots: 2, class: 'special-opening-task' },
            LOTTERY: { name: "æŠ½é¸ï¼ˆæº–å‚™ã€ç‰‡ä»˜ã‘ï¼‰", slots: 3, class: 'special-opening-task' },
            S_CHECK: { name: "Så°ãƒã‚§ãƒƒã‚¯ã€ãƒ¦ãƒ‹ãƒ¡ãƒ¢", slots: 2, class: 'special-opening-task' },
            OVERALL_CHECK: { name: "å…¨ä½“ç¢ºèª", slots: 1, class: 'special-opening-task' },
            TIME_LAG_POWER: { name: "æ™‚å·®å³¶å°é›»è½ã¨ã—", slots: 1, class: 'special-opening-task' },
            MONEY_COLLECT: { name: "é‡‘éŠ­å›å", slots: 2, class: 'money-task' },
            PARKING_EMP: { name: "ç«‹é§ï¼ˆç¤¾å“¡ï¼‰", slots: 1, class: 'parking-task' },
            LOCK_CHECK: { name: "æ–½éŒ ãƒ»å·¥å…·ç®±ãƒã‚§ãƒƒã‚¯", slots: 1, class: 'lock-task' },
            HANDOFF_CLEANING: { name: "å¼•ç¶™ããƒ»äº‹å‹™æ‰€æ¸…æƒ", slots: 1, class: 'handoff-task' },
            WAREHOUSE: { name: "å€‰åº«æ•´ç†", slots: 2, class: 'free-task' },
            COUNTER_TASK: { name: "ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ¥­å‹™", slots: 1, class: 'alba-close-task' },
            DRINKS_FLAGS: { name: "é£²ã¿æ®‹ã—ãƒ»ãƒ•ãƒ©ãƒƒã‚°ç¢ºèª", slots: 1, class: 'alba-close-task' },
            PARKING_ALBA: { name: "ç«‹é§ï¼ˆã‚¢ãƒ«ãƒã‚¤ãƒˆï¼‰", slots: 1, class: 'parking-task' },
            HALL_REFILL: { name: "å³¶ä¸Šæ¸…æƒãƒ»ã‚«ãƒ¼ãƒ‰è£œå……", slots: 1, class: 'alba-close-task' }
        };
        const taskLists = {
            open: [SPECIAL_TASKS.MONEY_COUNT.name, SPECIAL_TASKS.OUTSIDE_SALES.name, SPECIAL_TASKS.P_CHECK.name, SPECIAL_TASKS.PROMOTION_CHECK.name, SPECIAL_TASKS.BRIEFING.name, SPECIAL_TASKS.OPEN_WAREHOUSE.name, SPECIAL_TASKS.LOTTERY.name, SPECIAL_TASKS.S_CHECK.name, SPECIAL_TASKS.OVERALL_CHECK.name, SPECIAL_TASKS.TIME_LAG_POWER.name, SPECIAL_TASKS.FREE_TASK.name],
            close: [SPECIAL_TASKS.MONEY_COLLECT.name, SPECIAL_TASKS.WAREHOUSE.name, SPECIAL_TASKS.COUNTER_TASK.name, SPECIAL_TASKS.PARKING_EMP.name, SPECIAL_TASKS.LOCK_CHECK.name, SPECIAL_TASKS.HANDOFF_CLEANING.name, SPECIAL_TASKS.DRINKS_FLAGS.name, SPECIAL_TASKS.PARKING_ALBA.name, SPECIAL_TASKS.HALL_REFILL.name, SPECIAL_TASKS.FREE_TASK.name]
        };

        window.isEditing = false;
        const EDIT_PASSWORD = "admin";
        window.currentDate = '';
        window.staffList = { early: [], late: [], closing_employee: [], closing_alba: [], fixed_money_count: "", fixed_open_warehouse: "", fixed_money_collect: "", fixed_warehouses: "", fixed_counters: "" };
        let deleteInfo = { type: null, sectionKey: null, staffIndex: null, taskIndex: null };

        function generateTimeSlots(startTime, endTime, intervalMinutes) {
            const slots = []; let [sH, sM] = startTime.split(':').map(Number); const [eH, eM] = endTime.split(':').map(Number);
            let cur = sH * 60 + sM; const end = eH * 60 + eM;
            while (cur <= end) { slots.push(`${String(Math.floor(cur/60)).padStart(2,'0')}:${String(cur%60).padStart(2,'0')}`); cur += intervalMinutes; }
            return slots;
        }
        const openTimeSlots = generateTimeSlots('07:00', '10:00', 15);
        const openAlbaTimeSlots = generateTimeSlots('09:00', '10:00', 15);
        const closeTimeSlots = generateTimeSlots('22:45', '23:30', 15);
        const openTimeIndexMap = new Map(); openTimeSlots.forEach((t, i) => openTimeIndexMap.set(t, i));
        const openAlbaTimeIndexMap = new Map(); openAlbaTimeSlots.forEach((t, i) => openAlbaTimeIndexMap.set(t, i));
        const closeTimeIndexMap = new Map(); closeTimeSlots.forEach((t, i) => closeTimeIndexMap.set(t, i));

        // Global functions for HTML access
        window.getTodayDateString = () => { const t = new Date(); return `${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,'0')}-${String(t.getDate()).padStart(2,'0')}`; };
        
        window.refreshCurrentView = function() {
            updateStaffLists(); generateSummaryView();
            const isOpen = document.getElementById('tab-open').classList.contains('bg-white');
            showSubTab(isOpen ? 'open' : 'close'); setEditingMode(window.isEditing);
            if (window.currentDate && document.getElementById('date-picker').value !== window.currentDate) document.getElementById('date-picker').value = window.currentDate;
            updateFixedStaffButtons();
        };

        window.setupInitialView = function() {
            setEditingMode(false); showSubTab('open'); updateStaffLists(); generateSummaryView(); updateFixedStaffButtons();
            const picker = document.getElementById('date-picker'); if (!picker.value) picker.value = window.getTodayDateString();
        };

        function updateFixedStaffButtons() {
            const btns = [{ id: 'fixed-money_count-btn', k: 'fixed_money_count' }, { id: 'fixed_open_warehouse-btn', k: 'fixed_open_warehouse' }, { id: 'fixed-money_collect-btn', k: 'fixed_money_collect' }, { id: 'fixed-warehouses-btn', k: 'fixed_warehouses' }, { id: 'fixed-counters-btn', k: 'fixed_counters' }];
            btns.forEach(i => { const b = document.getElementById(i.id); if(b) updateSelectButton(b, window.staffList[i.k] || "é¸æŠã—ã¦ãã ã•ã„", !window.staffList[i.k]); });
        }

        window.showSubTab = function(tabName) {
            const isOpen = tabName === 'open';
            document.getElementById('edit-content-open').classList.toggle('hidden', !isOpen);
            document.getElementById('edit-content-close').classList.toggle('hidden', isOpen);
            document.getElementById('view-content-open').classList.toggle('hidden', !isOpen);
            document.getElementById('view-content-close').classList.toggle('hidden', isOpen);
            document.getElementById('tab-open').className = isOpen ? "px-6 py-2.5 rounded-lg text-sm font-bold transition-all bg-white text-indigo-600 shadow-sm" : "px-6 py-2.5 rounded-lg text-sm font-bold transition-all text-slate-500 hover:text-slate-700";
            document.getElementById('tab-close').className = !isOpen ? "px-6 py-2.5 rounded-lg text-sm font-bold transition-all bg-white text-indigo-600 shadow-sm" : "px-6 py-2.5 rounded-lg text-sm font-bold transition-all text-slate-500 hover:text-slate-700";
        };

        window.showPasswordModal = () => { if(window.isEditing){setEditingMode(false);return;} document.getElementById('password-modal').classList.remove('hidden'); document.getElementById('password-input').value=""; document.getElementById('password-error').classList.add('hidden'); document.getElementById('password-input').focus(); };
        window.closePasswordModal = () => document.getElementById('password-modal').classList.add('hidden');
        window.checkPassword = () => { if(document.getElementById('password-input').value === EDIT_PASSWORD) { closePasswordModal(); setEditingMode(true); } else { document.getElementById('password-error').classList.remove('hidden'); } };
        window.setEditingMode = (isEdit) => { window.isEditing = isEdit; document.getElementById('view-mode-container').classList.toggle('hidden', isEdit); document.getElementById('edit-mode-container').classList.toggle('hidden', !isEdit); const b = document.getElementById('edit-mode-button'); if(b){ b.textContent = isEdit?"é–²è¦§ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã‚‹":"ç®¡ç†è€…ç·¨é›†"; b.className = isEdit?"text-xs font-bold text-white bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-full transition-colors shadow-md":"text-xs font-bold text-slate-600 bg-slate-100 hover:bg-slate-200 px-4 py-2 rounded-full transition-colors"; } };

        // Selection & Modals
        window.openFixedStaffSelect = (k, lk, t) => { if(!window.isEditing)return; let c=[], cl=[]; if(lk==='early_staff_candidates'){c=masterStaffList.employees;cl=[window.staffList.early];}else if(lk==='open_staff_candidates'){c=openStaffCandidates;cl=[window.staffList.early,window.staffList.late];}else{c=closingStaffCandidates;cl=[window.staffList.closing_employee,window.staffList.closing_alba];} const ac=cl.flatMap(l=>l.map(s=>s.name)); const mb=document.getElementById('select-modal-body'); mb.innerHTML=`<div class="select-modal-option text-slate-400" onclick="selectFixedStaff('${k}','')">æŒ‡å®šãªã—</div>`; const render=(l,lbl)=>{if(l.length>0){mb.innerHTML+=`<div class="px-4 py-2 text-xs font-bold text-slate-400 bg-slate-50 sticky top-0">${lbl}</div>`;l.forEach(n=>{mb.innerHTML+=`<div class="select-modal-option ${n===window.staffList[k]?'selected':''}" onclick="selectFixedStaff('${k}','${n}')">${n}</div>`;});}}; render(c.filter(n=>ac.includes(n)),"ãƒªã‚¹ãƒˆè¿½åŠ æ¸ˆã¿"); render(c.filter(n=>!ac.includes(n)),"æœªè¿½åŠ "); document.getElementById('select-modal-title').textContent=t; document.getElementById('select-modal').classList.remove('hidden'); };
        window.selectFixedStaff = (k, n) => { window.staffList[k]=n; if(n){const ie=masterStaffList.employees.includes(n); const tk=(k.includes('money')||k.includes('open_warehouse'))?(ie?'early':'late'):(ie?'closing_employee':'closing_alba'); if(!window.staffList[tk].some(s=>s.name===n)) window.staffList[tk].push({name:n,tasks:[{start:"",end:"",task:"",remarks:"ï¼ˆå›ºå®šï¼‰"}]});} updateFixedStaffButtons(); updateStaffLists(); closeSelectModal(); saveStaffListToFirestore(); };
        window.openStaffSelect = (sk, mk) => { if(!window.isEditing)return; const m=masterStaffList[mk], c=window.staffList[sk].map(s=>s.name); const mb=document.getElementById('select-modal-body'); mb.innerHTML=''; const o=m.filter(n=>!c.includes(n)); if(o.length===0) mb.innerHTML='<div class="p-4 text-center text-slate-400">å€™è£œãªã—</div>'; else o.forEach(n=>mb.innerHTML+=`<div class="select-modal-option" onclick="selectStaff('${sk}','${n}')">${n}</div>`); document.getElementById('select-modal-title').textContent="ã‚¹ã‚¿ãƒƒãƒ•è¿½åŠ "; document.getElementById('select-modal').classList.remove('hidden'); };
        window.selectStaff = (sk, n) => { if(!window.staffList[sk].find(s=>s.name===n)){window.staffList[sk].push({name:n,tasks:[{start:"",end:"",task:"",remarks:""}]}); updateStaffLists(); saveStaffListToFirestore();} closeSelectModal(); };
        window.closeSelectModal = () => document.getElementById('select-modal').classList.add('hidden');
        function updateSelectButton(b, t, p) { if(b){const s=b.querySelector('span');if(s)s.textContent=t; b.classList.toggle('placeholder',p);} }
        window.openTimeSelect = (sk,si,ti,f,ln) => { if(!window.isEditing)return; const l=(ln==='open')?openTimeSlots:closeTimeSlots; const mb=document.getElementById('select-modal-body'); mb.innerHTML=`<div class="select-modal-option text-slate-400" onclick="handleChange('${sk}',${si},${ti},'${f}','');closeSelectModal();updateStaffLists();">--:--</div>`; l.forEach(t=>mb.innerHTML+=`<div class="select-modal-option" onclick="handleChange('${sk}',${si},${ti},'${f}','${t}');closeSelectModal();updateStaffLists();">${t}</div>`); document.getElementById('select-modal-title').textContent="æ™‚é–“é¸æŠ"; document.getElementById('select-modal').classList.remove('hidden'); };
        window.openTaskSelect = (sk,si,ti,ln) => { if(!window.isEditing)return; const l=[...new Set(taskLists[ln])]; const mb=document.getElementById('select-modal-body'); mb.innerHTML=`<div class="select-modal-option text-slate-400" onclick="handleChange('${sk}',${si},${ti},'task','');closeSelectModal();updateStaffLists();">æœªé¸æŠ</div>`; l.forEach(t=>mb.innerHTML+=`<div class="select-modal-option" onclick="handleChange('${sk}',${si},${ti},'task','${t}');closeSelectModal();updateStaffLists();">${t}</div>`); document.getElementById('select-modal-title').textContent="ã‚¿ã‚¹ã‚¯é¸æŠ"; document.getElementById('select-modal').classList.remove('hidden'); };
        window.handleChange = (sk,si,ti,f,v) => { window.staffList[sk][si].tasks[ti][f]=v; saveStaffListToFirestore(); };
        window.addStaff = () => {}; window.addTask = (sk,si) => { window.staffList[sk][si].tasks.push({start:"",end:"",task:"",remarks:""}); updateStaffLists(); saveStaffListToFirestore(); };
        window.showDeleteModal = (t,sk,si,ti) => { deleteInfo={type:t,sectionKey:sk,staffIndex:si,taskIndex:ti}; document.getElementById('delete-modal-message').textContent=t==='staff'?`ã€Œ${window.staffList[sk][si].name}ã€ã•ã‚“ã‚’å‰Šé™¤ï¼Ÿ`:"ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ï¼Ÿ"; document.getElementById('delete-modal').classList.remove('hidden'); };
        window.cancelDelete = () => document.getElementById('delete-modal').classList.add('hidden');
        window.confirmDelete = () => { const {type,sectionKey,staffIndex,taskIndex}=deleteInfo; if(type==='staff'){ const n=window.staffList[sectionKey][staffIndex].name; window.staffList[sectionKey].splice(staffIndex,1); ['fixed_money_count','fixed_open_warehouse','fixed_money_collect','fixed_warehouses','fixed_counters'].forEach(k=>{if(window.staffList[k]===n)window.staffList[k]="";}); }else if(window.staffList[sectionKey][staffIndex].tasks.length>1){window.staffList[sectionKey][staffIndex].tasks.splice(taskIndex,1);} cancelDelete(); updateStaffLists(); generateSummaryView(); updateFixedStaffButtons(); saveStaffListToFirestore(); };

        // Auto Assign Logic
        function calcTime(t,m){let v=0; t.forEach(x=>{const s=m.get(x.start),e=m.get(x.end);if(s!==undefined&&e!==undefined&&e>s)v+=(e-s);}); return v;}
        function isOverlap(t,s,e,m){for(const x of t){const S=m.get(x.start),E=m.get(x.end);if(S!==undefined&&E!==undefined&&S<e&&E>s)return true;}return false;}
        function findStaff(g,s,e,m){let min=Infinity,tgt=null; const idx=g.map((_,i)=>i).sort(()=>Math.random()-0.5); for(const i of idx){if(isOverlap(g[i].tasks,s,e,m))continue; const v=calcTime(g[i].tasks,m); if(v<min){min=v;tgt={staff:g[i]};}} return tgt;}
        window.autoAssignTasks = (sec, list) => {
            const emp=window.staffList[sec==='early'?'early':'closing_employee'], alba=window.staffList[sec==='late'?'late':'closing_alba'], all=[...emp,...alba];
            all.forEach(s=>s.tasks=[]);
            if(list==='open'){
                const m=emp.find(s=>s.name===window.staffList.fixed_money_count); if(m) m.tasks.push({start:'07:00',end:'08:15',task:SPECIAL_TASKS.MONEY_COUNT.name,remarks:'ï¼ˆå›ºå®šï¼‰'});
                const w=all.find(s=>s.name===window.staffList.fixed_open_warehouse); if(w) w.tasks.push({start:'09:15',end:'09:45',task:SPECIAL_TASKS.OPEN_WAREHOUSE.name,remarks:'ï¼ˆå›ºå®šï¼‰'});
                const t=[{t:SPECIAL_TASKS.OUTSIDE_SALES,s:'07:00',e:'07:15',g:emp.filter(s=>s!==m)}, {t:SPECIAL_TASKS.P_CHECK,s:'07:15',e:'07:30',g:emp.filter(s=>s!==m)}, {t:SPECIAL_TASKS.PROMOTION_CHECK,s:'07:30',e:'07:45',g:emp.filter(s=>s!==m)}, {t:SPECIAL_TASKS.LOTTERY,s:'09:15',e:'10:00',g:all,c:2}, {t:SPECIAL_TASKS.S_CHECK,s:'09:30',e:'10:00',g:alba,c:1}, {t:SPECIAL_TASKS.OVERALL_CHECK,s:'09:45',e:'10:00',g:emp,c:1}];
                if(!w) t.push({t:SPECIAL_TASKS.OPEN_WAREHOUSE,s:'09:15',e:'09:45',g:emp,c:1});
                all.forEach(s=>s.tasks.push({start:'09:00',end:'09:15',task:SPECIAL_TASKS.BRIEFING.name,remarks:""}));
                t.forEach(i=>{for(let k=0;k<(i.c||1);k++){const x=findStaff(i.g,openTimeIndexMap.get(i.s),openTimeIndexMap.get(i.e),openTimeIndexMap); if(x)x.staff.tasks.push({start:i.s,end:i.e,task:i.t.name,remarks:""});}});
                fillFree(all,openTimeSlots,openTimeIndexMap,emp);
            } else {
                const fix=[{k:'fixed_money_collect',t:SPECIAL_TASKS.MONEY_COLLECT,s:'22:45',e:'23:15',g:emp},{k:'fixed_warehouses',t:SPECIAL_TASKS.WAREHOUSE,s:'22:45',e:'23:15',g:all},{k:'fixed_counters',t:SPECIAL_TASKS.COUNTER_TASK,s:'22:45',e:'23:00',g:all}];
                const as=new Set(); fix.forEach(f=>{const s=f.g.find(p=>p.name===window.staffList[f.k]); if(s){s.tasks.push({start:f.s,end:f.e,task:f.t.name,remarks:'ï¼ˆå›ºå®šï¼‰'}); as.add(s);}});
                const t=[{t:SPECIAL_TASKS.LOCK_CHECK,s:1,g:emp.filter(s=>!as.has(s))},{t:SPECIAL_TASKS.HANDOFF_CLEANING,s:1,g:emp.filter(s=>!as.has(s))},{t:SPECIAL_TASKS.DRINKS_FLAGS,s:1,g:alba.filter(s=>!as.has(s))},{t:SPECIAL_TASKS.HALL_REFILL,s:1,g:alba.filter(s=>!as.has(s))}];
                fix.forEach(f=>{if(!window.staffList[f.k]) t.push({t:f.t,s:f.t.slots,g:(f.t===SPECIAL_TASKS.MONEY_COLLECT?emp:all.filter(s=>!as.has(s)))});});
                t.forEach(i=>{ for(let k=0;k<=closeTimeSlots.length-i.s;k++){ const x=findStaff(i.g,k,k+i.s,closeTimeIndexMap); if(x){x.staff.tasks.push({start:closeTimeSlots[k],end:closeTimeSlots[k+i.s],task:i.t.name,remarks:""}); break;} } });
                fillFree(all,closeTimeSlots,closeTimeIndexMap,[]);
            }
            updateStaffLists(); generateSummaryView(); saveStaffListToFirestore();
        };
        function fillFree(all,sl,m,emp){all.forEach(s=>{const st=emp.includes(s)?'07:00':'09:00'; const si=m.get(st)||0; for(let i=si;i<sl.length-1;i++){if(!isOverlap(s.tasks,i,i+1,m))s.tasks.push({start:sl[i],end:sl[i+1],task:SPECIAL_TASKS.FREE_TASK.name,remarks:""});} s.tasks.sort((a,b)=>(a.start||"").localeCompare(b.start||""));});}

        // UI Generation
        function updateStaffLists() { populate('staff-list-open-early','early','open'); populate('staff-list-open-late','late','open'); populate('staff-list-close-employee','closing_employee','close'); populate('staff-list-close-alba','closing_alba','close'); }
        function populate(id,sk,ln){ const c=document.getElementById(id); if(!c)return; c.innerHTML=''; window.staffList[sk].forEach((s,si)=>{ 
            let h=''; const st=s.tasks.sort((a,b)=>(a.start||'99').localeCompare(b.start||'99')); if(st.length===0)st.push({start:"",end:"",task:"",remarks:""});
            st.forEach((t,ti)=>{
                const f=t.remarks==="ï¼ˆå›ºå®šï¼‰", dis=f?'disabled':'', rem=(t.remarks||'').replace(/"/g,'&quot;');
                const act=f?`<span class="text-slate-300 text-lg px-2">Ã—</span>`:`<button onclick="showDeleteModal('task','${sk}',${si},${ti})" class="w-8 h-8 rounded-full bg-rose-50 text-rose-500 hover:bg-rose-100 flex items-center justify-center">Ã—</button>`;
                const add=`<button onclick="addTask('${sk}',${si})" class="w-8 h-8 rounded-full bg-slate-100 text-slate-600 hover:bg-slate-200 flex items-center justify-center">ï¼‹</button>`;
                const btn=(st.length>1||ti>0)?act:add;
                const cls="custom-select-button text-left w-full truncate " + (t.start?'':'placeholder');
                h+=`<tr class="edit-row ${ti>0?'border-t-0':''}"><td class="${ti>0?'hidden md:table-cell border-t-0':''}" data-label="ã‚¹ã‚¿ãƒƒãƒ•">${ti===0?`<div class="flex items-center gap-2"><span>${s.name}</span><button onclick="showDeleteModal('staff','${sk}',${si})" class="text-slate-300 hover:text-rose-500 transition text-lg ml-2">Ã—</button></div>`:''}</td>
                <td data-label="é–‹å§‹"><button class="${cls}" onclick="${!f?`openTimeSelect('${sk}',${si},${ti},'start','${ln}')`:''}" ${dis}><span>${t.start||'--'}</span></button></td>
                <td data-label="çµ‚äº†"><button class="${cls}" onclick="${!f?`openTimeSelect('${sk}',${si},${ti},'end','${ln}')`:''}" ${dis}><span>${t.end||'--'}</span></button></td>
                <td data-label="ã‚¿ã‚¹ã‚¯"><button class="${cls}" onclick="${!f?`openTaskSelect('${sk}',${si},${ti},'${ln}')`:''}" ${dis}><span>${t.task||'æœªé¸æŠ'}</span></button></td>
                <td data-label="å‚™è€ƒ"><input type="text" class="w-full bg-slate-50 border border-slate-200 rounded p-1 text-sm" value="${rem}" onchange="handleChange('${sk}',${si},${ti},'remarks',this.value)" ${f?'readonly':''}></td>
                <td data-label="æ“ä½œ">${btn}</td></tr>`;
            }); c.innerHTML+=h;
        });}
        function generateSummaryView() {
            const r=(id,l,sl)=>{
                const t=[]; l.forEach(s=>s.tasks.forEach(x=>{if(x.task&&x.task!==SPECIAL_TASKS.FREE_TASK.name)t.push({...x,name:s.name});}));
                const n=[...new Set(l.map(s=>s.name))].sort();
                document.getElementById(`${id}-desktop`).innerHTML=createTable(t,n,sl);
                document.getElementById(`${id}-mobile`).innerHTML=createList(t,n);
            };
            r('summary-open-employee-container',window.staffList.early,openTimeSlots);
            r('summary-open-alba-container',window.staffList.late,openAlbaTimeSlots);
            r('summary-close-employee-container',window.staffList.closing_employee,closeTimeSlots);
            r('summary-close-alba-container',window.staffList.closing_alba,closeTimeSlots);
        }
        function createTable(t,n,s){
            if(n.length===0)return '<p class="p-8 text-center text-slate-400">ã‚¹ã‚¿ãƒƒãƒ•ãªã—</p>';
            let h=`<div class="timeline-container"><table class="timeline-table"><thead><tr><th>STAFF</th>${s.map(x=>`<th>${x}</th>`).join('')}</tr></thead><tbody>`;
            const m=new Map(); s.forEach((x,i)=>m.set(x,i));
            n.forEach(name=>{
                h+=`<tr><th>${name}</th>`; const st=t.filter(x=>x.name===name).sort((a,b)=>a.start.localeCompare(b.start));
                let idx=0; while(idx<s.length){
                    const slot=s[idx], task=st.find(x=>x.start===slot);
                    if(task){
                        const start=m.get(task.start), end=m.get(task.end); let span=1;
                        if(end!==undefined&&end>start) span=end-start; else if(task.end==="10:00"||task.end==="23:30") span=1;
                        const cls=Object.values(SPECIAL_TASKS).find(v=>v.name===task.task)?.class||'';
                        h+=`<td colspan="${span}"><div class="task-bar ${cls}" onclick="showRemarksModal('${task.task}','${task.start}-${task.end}','${task.remarks||''}')">${task.task}${task.remarks?'â˜…':''}</div></td>`; idx+=span;
                    }else{h+='<td></td>'; idx++;}
                } h+='</tr>';
            }); return h+'</tbody></table></div>';
        }
        function createList(t,n){
            if(n.length===0)return'<p class="text-center text-slate-400">ãªã—</p>';
            let h='<div class="space-y-4">'; n.forEach(name=>{
                const st=t.filter(x=>x.name===name).sort((a,b)=>a.start.localeCompare(b.start));
                h+=`<div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden"><div class="bg-slate-50 px-4 py-2 font-bold text-slate-700 border-b border-slate-100 flex justify-between"><span>${name}</span><span class="text-xs bg-white px-2 py-1 rounded border">${st.length}</span></div><div class="p-2 space-y-2">`;
                if(st.length===0)h+='<div class="text-center text-xs text-slate-400">ã‚¿ã‚¹ã‚¯ãªã—</div>';
                st.forEach(x=>{ const cls=Object.values(SPECIAL_TASKS).find(v=>v.name===x.task)?.class||''; h+=`<div class="task-bar relative top-0 left-0 w-full h-auto block p-2 ${cls}"><div class="flex justify-between"><span>${x.task}</span><span class="opacity-70 text-xs">${x.start}-${x.end}</span></div>${x.remarks?`<div class="text-xs mt-1 border-t border-black/10 pt-1">${x.remarks}</div>`:''}</div>`; });
                h+='</div></div>';
            }); return h+'</div>';
        }
        window.showRemarksModal=(t,m,r)=>{document.getElementById('remarks-modal-task').textContent=t;document.getElementById('remarks-modal-time').textContent=m;document.getElementById('remarks-modal-text').textContent=r||"å‚™è€ƒãªã—";document.getElementById('remarks-modal').classList.remove('hidden');};
        window.closeRemarksModal=()=>document.getElementById('remarks-modal').classList.add('hidden');
    </script>

    <!-- =========================================
         FIREBASE & INTEGRATION MODULE
         ========================================= -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, updateDoc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // 1. Customer App Config (Garden Yashio Bot)
        const configCustomer = {
          apiKey: "AIzaSyAdxAeBlJkFWAVM1ZWJKhU2urQcmtL0UKo",
          authDomain: "gardenyashiobot.firebaseapp.com",
          projectId: "gardenyashiobot",
          storageBucket: "gardenyashiobot.firebasestorage.app",
          messagingSenderId: "692971442685",
          appId: "1:692971442685:web:ae4a65988ad1716ed84994"
        };

        // 2. Staff App Config (Task Manager - WakaTest)
        const configStaff = {
          apiKey: "AIzaSyBdjf2YJIo9OSJhPDBuEJAxqjVvS0qTN3E",
          authDomain: "wakatest-46f14.firebaseapp.com",
          projectId: "wakatest-46f14",
          storageBucket: "wakatest-46f14.firebasestorage.app",
          messagingSenderId: "770004156053",
          appId: "1:770004156053:web:04645f8fa745b07c03659c"
        };

        // Initialize Both Apps
        const appCustomer = initializeApp(configCustomer, "customerApp");
        const dbCustomer = getFirestore(appCustomer);

        const appStaff = initializeApp(configStaff, "staffApp");
        const dbStaff = getFirestore(appStaff);

        // --- Logic for Customer App ---
        let allMachines = [], newOpeningData = [], eventMap = new Map(), qscItems = [], currentQscTab = 'æœªå®Ÿæ–½';
        const $ = s => document.querySelector(s);
        const $$ = s => document.querySelectorAll(s);
        const latestKeywords = ["ã‚¢ã‚ºãƒ¼ãƒ«ãƒ¬ãƒ¼ãƒ³", "åŒ—æ–—ã®æ‹³11", "åœ°ç„å°‘å¥³7500", "æµ·ç‰©èªæ¥µ", "åŒ–ç‰©èª", "ãƒ—ãƒªã‚ºãƒ ãƒŠãƒŠ", "ãƒãƒ¼ãƒ‹ãƒ³ã‚°ã‚¨ã‚­ã‚¹ãƒ—ãƒ¬ã‚¹"];

        async function fetchData() {
            try {
                const [mSnap, nSnap, cSnap] = await Promise.all([
                    getDocs(collection(dbCustomer, "machines")),
                    getDocs(collection(dbCustomer, "newOpening")),
                    getDocs(collection(dbCustomer, "calendar"))
                ]);
                allMachines = mSnap.docs.map(d => d.data()).sort((a, b) => a.name.localeCompare(b.name));
                newOpeningData = nSnap.docs.map(d => d.data());
                eventMap = new Map(cSnap.docs.map(d => d.data()).sort((a, b) => a.date - b.date).map(e => [e.date, e]));
                renderToday();
            } catch (e) { console.error("Fetch Error:", e); $("#todayEventContainer").innerHTML = `<p class="text-rose-500 text-center font-bold">ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>`; }
        }

        function subscribeQSC() {
            onSnapshot(collection(dbCustomer, "qsc_items"), (snapshot) => {
                qscItems = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })).sort((a,b) => a.no - b.no);
                const unfinishedCount = qscItems.filter(i => i.status === "æœªå®Ÿæ–½").length;
                $("#qscUnfinishedCount").textContent = unfinishedCount > 0 ? `æ®‹ã‚Š ${unfinishedCount} ä»¶ã®å¯¾å¿œãŒå¿…è¦ã§ã™` : `ã™ã¹ã¦å®Œäº†ã—ã¾ã—ãŸï¼`;
                if(!$("#qscModal").classList.contains("hidden")) renderQSCList();
            });
        }
        function renderQSCList() {
            const container = $("#qscListContainer"); container.innerHTML = "";
            const filteredItems = qscItems.filter(item => currentQscTab === 'æœªå®Ÿæ–½' ? item.status === "æœªå®Ÿæ–½" : item.status === "å®Œäº†");
            if (filteredItems.length === 0) { container.innerHTML = `<div class="text-center py-10 text-slate-400 font-bold">é …ç›®ã¯ã‚ã‚Šã¾ã›ã‚“</div>`; return; }
            const grouped = {}; filteredItems.forEach(item => { if(!grouped[item.area]) grouped[item.area] = []; grouped[item.area].push(item); });
            for(const [area, items] of Object.entries(grouped)) {
                const header = document.createElement("div"); header.className = "text-xs font-bold text-slate-500 bg-slate-200/50 px-3 py-1 rounded mt-4 mb-2 first:mt-0"; header.textContent = area; container.appendChild(header);
                items.forEach(item => {
                    const div = document.createElement("div"); div.className = `bg-white p-4 rounded-xl border ${item.status === 'å®Œäº†' ? 'border-slate-100 opacity-60' : 'border-slate-200'} shadow-sm flex items-start gap-4 transition-all`;
                    const checkbox = document.createElement("input"); checkbox.type = "checkbox"; checkbox.className = "qsc-checkbox shrink-0 mt-0.5"; checkbox.checked = item.status === "å®Œäº†";
                    checkbox.onchange = async () => { const newStatus = checkbox.checked ? "å®Œäº†" : "æœªå®Ÿæ–½"; try { await updateDoc(doc(dbCustomer, "qsc_items", item.id), { status: newStatus }); } catch(e) { console.error(e); checkbox.checked = !checkbox.checked; } };
                    const textDiv = document.createElement("div"); textDiv.className = "flex-1"; textDiv.innerHTML = `<div class="flex items-center gap-2 mb-1"><span class="text-xs font-black bg-indigo-50 text-indigo-600 px-1.5 py-0.5 rounded">No.${item.no}</span>${item.status === 'å®Œäº†' ? '<span class="text-xs font-bold text-green-600">DONE</span>' : ''}</div><p class="text-sm font-bold text-slate-700 leading-snug ${item.status === 'å®Œäº†' ? 'line-through text-slate-400' : ''}">${item.content}</p>`;
                    div.appendChild(checkbox); div.appendChild(textDiv); container.appendChild(div);
                });
            }
        }
        function renderToday() {
            const today = new Date(); const d = today.getDate(); const m = today.getMonth(); const y = today.getFullYear();
            const monthNames = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
            const ev = eventMap.get(d);
            const html = ev ? `<div class="bg-slate-50 rounded-2xl p-6 border border-slate-100 w-full"><div class="flex items-center justify-between mb-4 pb-4 border-b border-slate-200/60"><div class="flex items-center gap-3"><div class="bg-indigo-600 text-white rounded-xl px-4 py-2 text-center shadow-md shadow-indigo-200"><div class="text-[10px] font-bold opacity-80 tracking-wider">${monthNames[m]}</div><div class="text-2xl font-black leading-none">${d}</div></div><div class="font-bold text-indigo-900 text-lg">æœ¬æ—¥ã®ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±</div></div><span class="bg-indigo-100 text-indigo-700 text-xs font-bold px-2 py-1 rounded">TODAY</span></div><ul class="space-y-3">${ev.p_event ? `<li class="flex items-start p-2 rounded-lg hover:bg-white transition-colors"><span class="w-1.5 h-1.5 rounded-full bg-indigo-500 mt-2 mr-3 shrink-0"></span><span class="text-slate-700 font-bold text-sm leading-relaxed">${ev.p_event}</span></li>` : ''}${ev.s_event ? `<li class="flex items-start p-2 rounded-lg hover:bg-white transition-colors"><span class="w-1.5 h-1.5 rounded-full bg-purple-500 mt-2 mr-3 shrink-0"></span><span class="text-slate-700 font-bold text-sm leading-relaxed">${ev.s_event}</span></li>` : ''}${ev.recommend ? `<li class="flex items-start p-2 rounded-lg hover:bg-rose-50 transition-colors"><span class="w-1.5 h-1.5 rounded-full bg-rose-500 mt-2 mr-3 shrink-0"></span><span class="text-rose-600 font-bold text-sm leading-relaxed">${ev.recommend}</span></li>` : ''}</ul></div>` : `<div class="flex flex-col items-center justify-center py-10 text-slate-400 bg-slate-50 rounded-2xl border border-slate-100 w-full"><div class="text-5xl font-black text-slate-200 mb-3">${d}</div><p class="text-sm font-bold">ç‰¹åˆ¥ãªã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ã¯ã‚ã‚Šã¾ã›ã‚“</p></div>`;
            $("#todayEventContainer").innerHTML = html; $("#currentDate").textContent = `${y}.${m + 1}.${d}`;
        }
        function openNewOpening() {
            const container = $("#newOpeningInfo"); container.innerHTML = "";
            if (newOpeningData.length === 0) { container.innerHTML = "<p class='text-center text-slate-400 py-10'>ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>"; $("#newOpeningModal").classList.remove("hidden"); return; }
            const latest = [], others = []; newOpeningData.forEach(m => { (latestKeywords.some(k => m.name.includes(k)) ? latest : others).push(m); });
            const createList = (list) => {
                const ul = document.createElement("ul"); ul.className = "grid grid-cols-1 sm:grid-cols-2 gap-3 mb-8";
                list.sort((a,b)=>b.count-a.count).forEach(item => {
                    const li = document.createElement("li"); li.className = "bg-white border border-slate-200 rounded-xl p-4 flex justify-between items-center shadow-sm hover:border-indigo-300 hover:shadow-md transition-all cursor-pointer group";
                    const matched = allMachines.find(m => m.name === item.name || m.name.includes(item.name));
                    li.innerHTML = `<div class="flex flex-col overflow-hidden mr-2"><span class="font-bold text-slate-700 truncate text-sm sm:text-base group-hover:text-indigo-700 transition-colors">${item.name}</span>${matched&&matched.salesPitch?`<span class="text-xs text-slate-400 font-medium mt-1 flex items-center"><span class="w-1.5 h-1.5 bg-indigo-400 rounded-full mr-1.5"></span>ã‚¿ãƒƒãƒ—ã—ã¦è©³ç´°</span>`:''}</div><span class="text-xs font-black bg-slate-800 text-white px-2.5 py-1.5 rounded-lg shrink-0">${item.count}å°</span>`;
                    if(matched && matched.salesPitch) li.onclick = () => { $("#detailName").textContent = matched.name; $("#detailPitch").textContent = matched.salesPitch || "æƒ…å ±ãªã—"; const f=(i,l)=>{$(i).innerHTML="";(l||["æƒ…å ±ãªã—"]).forEach(t=>$(i).innerHTML+=`<li class="flex items-start"><span class="mr-2 mt-1.5 w-1.5 h-1.5 bg-current rounded-full flex-shrink-0"></span><span>${t}</span></li>`);}; f("#detailPros", matched.pros); f("#detailCons", matched.cons); $("#machineDetailModal").classList.remove("hidden"); };
                    ul.appendChild(li);
                }); return ul;
            };
            if(latest.length > 0) { const h = document.createElement("h3"); h.className = "text-lg font-black text-rose-600 mb-4 flex items-center border-b border-rose-100 pb-2"; h.innerHTML = `âœ¨ æœ€æ–°å°å…¥`; container.appendChild(h); container.appendChild(createList(latest)); }
            if(others.length > 0) { const h = document.createElement("h3"); h.className = "text-lg font-black text-slate-600 mb-4 flex items-center border-b border-slate-200 pb-2"; h.innerHTML = `ğŸ”„ æº–æ–°å°ãƒ»ãã®ä»–`; container.appendChild(h); container.appendChild(createList(others)); }
            $("#newOpeningModal").classList.remove("hidden");
        }

        // --- Logic for Staff App (Wiring) ---
        let unsubscribeFromTasks = null;
        window.taskDocRef = null;
        
        // Expose Staff DB functions to global window for script.js to use
        window.saveStaffListToFirestore = async function() {
            if (!window.isEditing || !window.taskDocRef) return;
            try { const cleanData = JSON.parse(JSON.stringify(window.staffList, (key, value) => (value === null || value === undefined) ? "" : value)); await setDoc(window.taskDocRef, cleanData); } catch (error) { console.error("Error saving:", error); }
        };
        
        window.handleDateChange = function(dateString) {
            if (!dateString) dateString = window.getTodayDateString();
            window.currentDate = dateString;
            const picker = document.getElementById('date-picker'); if(picker) picker.value = dateString;
            window.taskDocRef = doc(dbStaff, 'artifacts', configStaff.projectId, 'public', 'data', 'task_assignments', dateString);
            
            if (unsubscribeFromTasks) unsubscribeFromTasks();
            unsubscribeFromTasks = onSnapshot(window.taskDocRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    window.staffList.early = data.early || [];
                    window.staffList.late = data.late || [];
                    window.staffList.closing_employee = data.closing_employee || [];
                    window.staffList.closing_alba = data.closing_alba || [];
                    window.staffList.fixed_warehouses = data.fixed_warehouses || "";
                    window.staffList.fixed_counters = data.fixed_counters || "";
                    window.staffList.fixed_money_count = data.fixed_money_count || "";
                    window.staffList.fixed_money_collect = data.fixed_money_collect || "";
                    window.staffList.fixed_open_warehouse = data.fixed_open_warehouse || "";
                } else {
                    window.staffList = { early: [], late: [], closing_employee: [], closing_alba: [], fixed_money_count: "", fixed_open_warehouse: "", fixed_money_collect: "", fixed_warehouses: "", fixed_counters: "" };
                }
                if(window.refreshCurrentView) window.refreshCurrentView();
            });
        };

        // Event Listeners (Customer)
        window.addEventListener("DOMContentLoaded", () => {
            fetchData();
            subscribeQSC();
            // QSC Tabs
            $("#qscTabUnfinished").onclick = () => { currentQscTab = 'æœªå®Ÿæ–½'; $("#qscTabUnfinished").className = "px-3 py-1 text-xs font-bold rounded-md bg-white text-rose-600 shadow-sm transition-all"; $("#qscTabFinished").className = "px-3 py-1 text-xs font-bold rounded-md text-slate-400 hover:text-slate-600 transition-all"; renderQSCList(); };
            $("#qscTabFinished").onclick = () => { currentQscTab = 'å®Œäº†'; $("#qscTabFinished").className = "px-3 py-1 text-xs font-bold rounded-md bg-white text-green-600 shadow-sm transition-all"; $("#qscTabUnfinished").className = "px-3 py-1 text-xs font-bold rounded-md text-slate-400 hover:text-slate-600 transition-all"; renderQSCList(); };
            $("#newOpeningButton").onclick = openNewOpening;
            $("#closeNewOpeningModal").onclick = () => $("#newOpeningModal").classList.add("hidden");
            $("#closeDetailModal").onclick = () => $("#machineDetailModal").classList.add("hidden");
            $("#openQSCButton").onclick = () => { $("#qscModal").classList.remove("hidden"); renderQSCList(); };
            $("#closeQscModal").onclick = () => $("#qscModal").classList.add("hidden");
            $("#calendarToggleButton").onclick = () => {
                const full = $("#fullCalendarContainer"), today = $("#todayEventContainer"), btn = $("#calendarToggleButton");
                if (full.classList.contains("hidden")) {
                    full.classList.remove("hidden"); today.classList.add("hidden"); btn.textContent = "æœ¬æ—¥ã®ã‚¤ãƒ™ãƒ³ãƒˆã«æˆ»ã‚‹";
                    const grid = $("#calendarGrid"); grid.innerHTML = ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"].map(d => `<div class="text-xs font-bold text-slate-300 text-center py-2">${d}</div>`).join(""); for(let i=0; i<6; i++) grid.innerHTML += `<div></div>`;
                    const days = new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).getDate();
                    for(let i=1; i<=days; i++) {
                        const ev = eventMap.get(i); const btn = document.createElement("button"); btn.className = `calendar-day ${ev&&(ev.p_event||ev.s_event)?'has-event':''}`; btn.textContent = i;
                        if (i === new Date().getDate()) btn.classList.add('is-today');
                        btn.onclick = () => { $$(".calendar-day").forEach(b => b.classList.remove("is-selected")); btn.classList.add("is-selected"); $("#selectedEventDetails").innerHTML = ev ? `<div class="w-full"><div class="text-indigo-600 font-black mb-3 flex items-center text-lg"><span class="bg-indigo-100 text-indigo-600 text-xs px-2 py-1 rounded mr-2">${new Date().getMonth() + 1}/${i}</span> è©³ç´°</div><ul class="space-y-2 text-sm font-bold text-slate-700">${ev.p_event ? `<li class="flex items-start"><span class="w-1.5 h-1.5 bg-indigo-400 rounded-full mr-2 mt-1.5 shrink-0"></span>${ev.p_event}</li>` : ''}${ev.s_event ? `<li class="flex items-start"><span class="w-1.5 h-1.5 bg-purple-400 rounded-full mr-2 mt-1.5 shrink-0"></span>${ev.s_event}</li>` : ''}${ev.recommend ? `<li class="flex items-start text-rose-600"><span class="w-1.5 h-1.5 bg-rose-400 rounded-full mr-2 mt-1.5 shrink-0"></span>${ev.recommend}</li>` : ''}</ul></div>` : `<p class='text-slate-400'>æƒ…å ±ãªã—</p>`; };
                        grid.appendChild(btn);
                    }
                } else { full.classList.add("hidden"); today.classList.remove("hidden"); btn.textContent = "ä»Šæœˆå…¨ä½“ã‚’è¦‹ã‚‹"; }
            };
        });

        // VIEW SWITCHER
        window.switchView = function(viewName) {
            const customerApp = document.getElementById('app-customer');
            const staffApp = document.getElementById('app-staff');
            window.scrollTo(0,0);
            if (viewName === 'staff') {
                customerApp.classList.add('hidden');
                staffApp.classList.remove('hidden');
                // Initialize Staff App on first click
                if (!window.taskDocRef) {
                    window.setupInitialView();
                    window.handleDateChange(window.getTodayDateString());
                }
            } else {
                staffApp.classList.add('hidden');
                customerApp.classList.remove('hidden');
            }
        };
    </script>
</body>
</html>